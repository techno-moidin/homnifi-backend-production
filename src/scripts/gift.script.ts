import { NestFactory } from '@nestjs/core';
import { AppModule } from '../app.module';
import { AxiosResponse } from 'axios';
import { firstValueFrom } from 'rxjs';
import { HttpService } from '@nestjs/axios';
import { v4 as uuidv4 } from 'uuid';
import e from 'express';
// const bids = [
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
//   '7263520977',
// ];

const bids = [
  '1068390584',
  '9169664371',
  '6736534326',
  '8366956985',
  '8747412302',
  '0214903148',
  '1710094980',
  '7764828002',
  '7772696333',
  '9168880722',
  '1244193800',
  '1569049337',
  '6614059259',
  '2536456317',
  '6604728858',
  '5289863292',
  '2172291231',
  '7629920081',
  '9657566753',
  '1053064456',
  '2429182780',
  '2173983249',
  '3773400703',
  '5597818086',
  '9844997467',
  '9375980827',
  '5461790302',
  '0832634064',
  '1065621407',
  '4447151135',
  '7053870485',
  '0313228931',
  '6958704680',
  '6411206231',
  '0064936078',
  '4122603706',
  '2014282032',
  '0729977909',
  '4583477333',
  '7391586433',
  '5398290496',
  '7887381400',
  '9062678102',
  '9765279084',
  '3291011457',
  '5226887943',
  '1937552407',
  '2606454685',
  '7863180145',
  '4126509043',
  '0436699807',
  '3465144818',
  '9491545596',
  '7038586148',
  '0963017620',
  '6128733667',
  '8876707894',
  '6682003376',
  '5272513677',
  '2258438739',
  '7887135633',
  '3551604157',
  '4278424969',
  '8399138293',
  '8586687022',
  '9404555949',
  '2834689589',
  '7475804153',
  '4970640656',
  '2135567910',
  '8151582897',
  '2909948941',
  '3879042805',
  '7189228785',
  '3522365011',
  '4834871348',
  '1887857731',
  '6305579897',
  '1824589783',
  '2202252733',
  '3345790535',
  '8053291630',
  '8462458973',
  '9715102999',
  '0748992770',
  '4176888977',
  '7622186987',
  '7200412078',
  '1967668472',
  '0888391803',
  '1874961700',
  '5370531707',
  '8869598918',
  '7767378999',
  '5757666547',
  '7001116646',
  '4395396587',
  '2888732862',
  '8806958266',
  '0160036985',
  '2310625539',
  '1196246791',
  '1991415450',
  '3179174272',
  '8847826979',
  '1835942871',
  '3707525957',
  '5513464162',
  '6771012237',
  '7885229902',
  '7944832929',
  '8320687182',
  '8586924720',
  '1503974977',
  '0455276408',
  '6575431594',
  '5931141427',
];

async function bootstrap() {
  const appContext = await NestFactory.createApplicationContext(AppModule);
  const httpService = appContext.get(HttpService);

  const BATCH_SIZE = 10; // Number of API calls per batch

  for (let i = 0; i < bids.length; i += BATCH_SIZE) {
    const batch = bids.slice(i, i + BATCH_SIZE);

    const apiCalls = batch.map((bid) => {
      return firstValueFrom(
        httpService.post(
          'https://api.homnifi.com/webhooks/deposit/v2',
          {
            address: bid,
            hash: uuidv4() + '-gift',
            token: 'gift',
            amount: 4500,
            platform: 'homnifi',
            note: 'gift to purchase homnifi cyclone minter || by scripting', // optional
            isBid: true,
          },
          {
            headers: {
              'x-api-key': '',
            },
            timeout: 10000,
          },
        ),
      )
        .then((response: AxiosResponse<any>) => {
          console.log(`Response for ${bid}:`, response.data);
          return response.data;
        })
        .catch((error) => {
          console.log(error);

          console.error(`Error for ${bid}:`, error.message);
          return null; // Handle errors gracefully
        });
    });

    await Promise.allSettled(apiCalls);
  }

  console.info('Good Job, All done!');
  process.exit(0);
}

bootstrap().catch((err) => {
  console.error('Error populating database:', err);
  process.exit(1);
});
